code from John
again updated code
